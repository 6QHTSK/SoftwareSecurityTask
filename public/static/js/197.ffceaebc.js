"use strict";(self["webpackChunkdetour"]=self["webpackChunkdetour"]||[]).push([[197],{197:(e,t,a)=>{a.r(t),a.d(t,{default:()=>K});a(246);var l=a(3673),n=a(8880),i=a(2323);const o={class:"col-7",style:{"padding-top":"1em"}},r={class:"fit column wrap q-gutter-sm"},s=(0,l.Uk)(" 离线状态，无法连接到行为分析器 "),c={style:{width:"6em","padding-left":"0.5em"}},u={key:0,style:{transition:"all 200ms"}},d={key:1,class:"fit row wrap q-gutter-xs items-end content-end",style:{transition:"all 200ms"}},w=(0,l.Uk)("追踪记录"),m={key:2,class:"fit row wrap justify-center"},g=(0,l.Uk)("追踪总计"),f=(0,l.Uk)("Total"),k=(0,l.Uk)("导出文件"),p=(0,l._)("div",{style:{width:"0.5em"}},null,-1),h=(0,l.Uk)("正在连接Detour……"),v=(0,l.Uk)("这里什么都没有……"),W={key:0,style:{width:"0.5em"}},y=(0,l.Uk)("Microsoft API文档");function _(e,t,a,_,b,C){const D=(0,l.up)("q-icon"),T=(0,l.up)("q-banner"),q=(0,l.up)("q-btn"),I=(0,l.up)("q-badge"),x=(0,l.up)("q-input"),j=(0,l.up)("q-card-section"),S=(0,l.up)("q-card"),H=(0,l.up)("q-chip"),U=(0,l.up)("q-avatar"),E=(0,l.up)("q-item-section"),F=(0,l.up)("q-item-label"),Z=(0,l.up)("q-item"),L=(0,l.up)("q-separator"),z=(0,l.up)("q-list"),M=(0,l.up)("q-scroll-area"),Q=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(Q,{class:"row wrap justify-center items-start content-start"},{default:(0,l.w5)((()=>[(0,l._)("div",o,[(0,l._)("div",r,[e.socketConnect?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(T,{key:0,dense:"","inline-actions":"",class:"text-white bg-red"},{avatar:(0,l.w5)((()=>[(0,l.Wm)(D,{name:"signal_wifi_off"})])),default:(0,l.w5)((()=>[s])),_:1})),(0,l.Wm)(S,{style:{overflow:"auto"}},{default:(0,l.w5)((()=>[(0,l.Wm)(j,{class:"fit column wrap q-gutter-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{dense:"",modelValue:e.targetFile,"onUpdate:modelValue":t[0]||(t[0]=t=>e.targetFile=t),"bottom-slots":"",readonly:e.startTrace},{after:(0,l.w5)((()=>[(0,l._)("div",c,[e.startTrace?((0,l.wg)(),(0,l.j4)(q,{key:1,color:"secondary",class:"full-width",dense:"",label:"停止追踪",onClick:e.btnStopTrace,disable:!e.socketConnect},null,8,["onClick","disable"])):((0,l.wg)(),(0,l.j4)(q,{key:0,class:"full-width",color:"primary",dense:"",label:"开始追踪",disable:""===e.targetFile||!e.socketConnect,onClick:e.btnStartTrace},null,8,["disable","onClick"]))])])),hint:(0,l.w5)((()=>[(0,l.Wm)(n.W3,{name:"hint"},{default:(0,l.w5)((()=>[0===e.runtimeInfo.pid?((0,l.wg)(),(0,l.iD)("p",u,"输入需要追踪的目标文件的路径")):((0,l.wg)(),(0,l.iD)("div",d,[(0,l.Wm)(I,{rounded:"",class:"q-mx-xs",label:"PID: "+e.runtimeInfo.pid},null,8,["label"]),(0,l.Wm)(I,{rounded:"",class:"q-mx-xs",label:"ThreadID: "+e.runtimeInfo.threadID},null,8,["label"])]))])),_:1})])),_:1},8,["modelValue","readonly"])])),_:1})])),_:1}),e.firstTrace?((0,l.wg)(),(0,l.j4)(S,{key:1},{default:(0,l.w5)((()=>[(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[(0,l.Wm)(n.W3,{name:"event",tag:"q-scroll-area",class:"row q-gutter-xs full-width full-height"},{default:(0,l.w5)((()=>[(0,l.Wm)(H,{rounded:"",style:{transition:"all 200ms"},color:"secondary","text-color":"white",key:0},{default:(0,l.w5)((()=>[w])),_:1}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.eventCount,(t=>((0,l.wg)(),(0,l.j4)(H,{clickable:"",rounded:"",key:e.eventCount-t,style:{transition:"all 200ms"},color:e.viewEvent===e.eventCount-t?"accent":"secondary",onClick:a=>e.changeViewEvent(e.eventCount-t),"text-color":"white"},{default:(0,l.w5)((()=>[(0,l.Uk)("#"+(0,i.zw)(e.eventCount-t+1),1)])),_:2},1032,["color","onClick"])))),128))])),_:1})])),_:1})])),_:1})):(0,l.kq)("",!0),e.firstTrace?((0,l.wg)(),(0,l.iD)("div",m,[(0,l.Wm)(S,{style:{height:"45em",width:"220px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(z,{bordered:""},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,{clickable:"",onClick:t[1]||(t[1]=t=>e.filterSwitch["Main"]=!e.filterSwitch["Main"]),active:e.filterSwitch["Main"],"active-class":"bg-blue-1 text-primary"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{icon:"home"})])),_:1}),(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[g])),_:1}),(0,l.Wm)(F,{caption:""},{default:(0,l.w5)((()=>[f])),_:1})])),_:1}),(0,l.Wm)(n.W3,{name:"tag",tag:"q-item-section",class:"column q-gutter-xs items-end content-end"},{default:(0,l.w5)((()=>[Object.values(e.infoTraceCount).reduce(((e,t)=>e+t),0)>0?((0,l.wg)(),(0,l.j4)(I,{key:0,color:"info",style:{transition:"all 200ms"},label:Object.values(e.infoTraceCount).reduce(((e,t)=>e+t),0)},null,8,["label"])):(0,l.kq)("",!0),Object.values(e.warningTraceCount).reduce(((e,t)=>e+t),0)?((0,l.wg)(),(0,l.j4)(I,{key:1,color:"warning",style:{transition:"all 200ms"},label:Object.values(e.warningTraceCount).reduce(((e,t)=>e+t),0)},null,8,["label"])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["active"]),(0,l.Wm)(L),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.traceTypes,(t=>((0,l.wg)(),(0,l.j4)(Z,{key:t.label,clickable:"",onClick:a=>e.targetClick(t),active:e.filterSwitch[t.label]&&!e.filterSwitch["Main"],"active-class":"bg-teal-1 text-secondary"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{icon:e.icons[t.label]},null,8,["icon"])])),_:2},1024),(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(t.name),1)])),_:2},1024),(0,l.Wm)(F,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(t.label),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(n.W3,{name:"tag",tag:"q-item-section",class:"column q-gutter-xs items-end content-end"},{default:(0,l.w5)((()=>[e.infoTraceCount[t.label]>0?((0,l.wg)(),(0,l.j4)(I,{color:"info",key:"info",style:{transition:"all 200ms"},label:e.infoTraceCount[t.label]},null,8,["label"])):(0,l.kq)("",!0),e.warningTraceCount[t.label]>0?((0,l.wg)(),(0,l.j4)(I,{color:"warning",key:"warning",style:{transition:"all 200ms"},label:e.warningTraceCount[t.label]},null,8,["label"])):(0,l.kq)("",!0)])),_:2},1024)])),_:2},1032,["onClick","active"])))),128)),(0,l.Wm)(L),(0,l.Wm)(Z,{clickable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,{onClick:e.outputLogFile},{default:(0,l.w5)((()=>[k])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1}),p,(0,l.Wm)(S,{class:"col",style:{height:"45em"}},{default:(0,l.w5)((()=>[(0,l.Wm)(M,{class:"full-width full-height column"},{default:(0,l.w5)((()=>[(0,l.Wm)(n.W3,{name:"event",tag:"q-list"},{default:(0,l.w5)((()=>[0===e.events.length?((0,l.wg)(),(0,l.j4)(Z,{key:0,style:{transition:"all 200ms"},clickable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{color:"grey","text-color":"white",icon:"link"})])),_:1}),(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[h])),_:1})])),_:1})])),_:1})):0===e.eventsFilterList().length?((0,l.wg)(),(0,l.j4)(Z,{style:{transition:"all 200ms"},clickable:"",key:"Undefined"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{color:"grey","text-color":"white",icon:"search"})])),_:1}),(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[v])),_:1})])),_:1})])),_:1})):((0,l.wg)(!0),(0,l.iD)(l.HY,{key:2},(0,l.Ko)(e.eventsFilterList(),(t=>((0,l.wg)(),(0,l.j4)(Z,{key:t.id,style:{transition:"all 200ms"},clickable:"",onClick:a=>e.clickEvent(t)},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{color:e.convertWarningLevel(t["warningLevel"]),"text-color":"white",icon:e.icons[t["eventID"]]},null,8,["color","icon"])])),_:2},1024),(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(t["event"]["Operation"]),1)])),_:2},1024),(0,l.Wm)(F,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(t["description"]),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(E,{side:"",class:"column q-gutter-xs"},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)(" [#"+(0,i.zw)(t.id)+"] "+(0,i.zw)(e.getTime(t.time)),1)])),_:2},1024),t["warningLevel"]>0?((0,l.wg)(),(0,l.j4)(I,{key:0,color:e.convertWarningLevel(t["warningLevel"]),label:"警告: "+t.warnings.length},null,8,["color","label"])):((0,l.wg)(),(0,l.j4)(I,{key:1,color:"info",label:"未见异常"}))])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1}),e.detailsWindows?((0,l.wg)(),(0,l.iD)("div",W)):(0,l.kq)("",!0),e.detailsWindows?((0,l.wg)(),(0,l.j4)(S,{key:1,style:{height:"45em",width:"300px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,null,{default:(0,l.w5)((()=>[(0,l.Wm)(E,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{color:e.convertWarningLevel(e.detailsEvent["warningLevel"]),"text-color":"white",icon:e.icons[e.detailsEvent["eventID"]]},null,8,["color","icon"])])),_:1}),(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.detailsEvent["event"]["Operation"]),1)])),_:1}),(0,l.Wm)(F,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)("PID: "+(0,i.zw)(e.detailsEvent.pid),1)])),_:1}),(0,l.Wm)(F,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)("ThreadID: "+(0,i.zw)(e.detailsEvent.threadID),1)])),_:1})])),_:1}),(0,l.Wm)(E,{side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)("#"+(0,i.zw)(e.detailsEvent.id),1)])),_:1})])),_:1})])),_:1}),(0,l.Wm)(L),(0,l.Wm)(M,{class:"full-width column",style:{height:"562px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(z,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.detailsEvent.eventDescription,((e,t,a)=>((0,l.wg)(),(0,l.j4)(Z,{key:a,style:{"max-width":"300px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.description),1)])),_:2},1024),(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(t),1)])),_:2},1024),"string"==typeof e.value?((0,l.wg)(),(0,l.j4)(F,{key:0,caption:"",style:{"word-wrap":"break-word","word-break":"normal"}},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.value),1)])),_:2},1024)):((0,l.wg)(!0),(0,l.iD)(l.HY,{key:1},(0,l.Ko)(e.value,(e=>((0,l.wg)(),(0,l.j4)(F,{caption:"",key:e,style:{"word-wrap":"break-word","word-break":"normal"}},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e),1)])),_:2},1024)))),128))])),_:2},1024),(0,l.Wm)(E,{side:""},{default:(0,l.w5)((()=>["return"===t?((0,l.wg)(),(0,l.j4)(I,{key:0,label:"返回值",color:"primary"})):((0,l.wg)(),(0,l.j4)(I,{key:1,label:"参数",color:"info"}))])),_:2},1024)])),_:2},1024)))),128)),e.detailsEvent.warningLevel>0?((0,l.wg)(),(0,l.j4)(L,{key:0})):(0,l.kq)("",!0),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.detailsEvent.warnings,(e=>((0,l.wg)(),(0,l.j4)(Z,{key:e.WarningID},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{label:e.WarningID,color:"Danger"===e.type?"negative":"warning"},null,8,["label","color"])])),_:2},1024),(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.info),1)])),_:2},1024),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.extend,((e,t)=>((0,l.wg)(),(0,l.j4)(F,{caption:"",key:t},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128)),e.detailsEvent.document?((0,l.wg)(),(0,l.j4)(L,{key:1})):(0,l.kq)("",!0),e.detailsEvent.document?((0,l.wg)(),(0,l.j4)(Z,{key:2,dense:"",clickable:"",onClick:t[2]||(t[2]=t=>e.openApiDoc(e.detailsEvent.document))},{default:(0,l.w5)((()=>[(0,l.Wm)(E,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[y])),_:1})])),_:1})])),_:1})):(0,l.kq)("",!0)])),_:1})])),_:1})])),_:1})):(0,l.kq)("",!0)])):(0,l.kq)("",!0)])])])),_:1})}a(7098);var b=a(7645),C=a(2841);const D=(0,l.aZ)({name:"PageIndex",data:()=>({currentTime:new Date,targetFile:"S:\\softwareSecurityTask\\test\\Target4\\Debug\\Target4.exe",timer:null,startTrace:!1,firstTrace:!1,detailsWindows:!1,runtimeInfo:{pid:0,threadID:0},socketConnect:!1,detailsEvent:{event:{Operation:"HeapDestroy",hHeap:52887552,return:1},eventID:"Heap",pid:13040,threadID:3896,time:1631701840818,warnings:[{WarningID:113,type:"Warning",info:"Destroy Heap时有address未释放",extend:[52888840]}],warningLevel:1,description:"成功地摧毁了堆[0x03270000]",eventDescription:{hHeap:{description:"要摧毁的堆的句柄",value:"0x03270000"},return:{description:"摧毁结果",value:"成功"}},id:8,document:"https://docs.microsoft.com/en-us/windows/win32/api/heapapi/nf-heapapi-heapdestroy"},traceTypes:[{name:"Hook函数",label:"HookFunc"},{name:"弹框",label:"MessageBox"},{name:"堆",label:"Heap"},{name:"文件",label:"File"},{name:"注册表",label:"Regedit"}],infoTraceCount:{HookFunc:0,MessageBox:0,Heap:0,File:0,Regedit:0},warningTraceCount:{HookFunc:0,Heap:0,File:0,Regedit:0},icons:{HookFunc:"attach_file",MessageBox:"wysiwyg",Heap:"clear_all",File:"folder",Regedit:"app_registration"},filterSwitch:{Main:!0,HookFunc:!1,MessageBox:!1,Heap:!1,File:!1,Regedit:!1},events:[],eventSets:[],eventCount:0,viewEvent:0}),methods:{btnStartTrace(){let e=this;this.$axios.get("http://localhost:9013/trace/start",{params:{path:this.targetFile}}).then((t=>{t.data.result?(e.eventSets.push({events:[],runtimeInfo:{pid:0,threadID:0},infoTraceCount:{HookFunc:0,MessageBox:0,Heap:0,File:0,Regedit:0},warningTraceCount:{HookFunc:0,Heap:0,File:0,Regedit:0}}),e.changeViewEvent(this.eventCount),e.startTrace=!0,e.firstTrace=!0,e.eventCount++):this.$q.notify({message:"打开目标文件失败",color:"negative"})}))},btnStopTrace(){this.startTrace=!1,this.$axios.get("http://localhost:9013/trace/stop")},convertWarningLevel(e){switch(e){case 0:return"info";case 1:return"warning";case 2:return"negative"}return"info"},getTime(e){return b.ZP.formatDate(e,"YYYY/MM/DD HH:mm:ss.SSS")},targetClick(e){this.filterSwitch["Main"]?(this.filterSwitch["Main"]=!1,this.filterSwitch[e.label]=!0):this.filterSwitch[e.label]=!this.filterSwitch[e.label]},eventsFilterList(){return this.events.filter((e=>this.filterSwitch["Main"]||this.filterSwitch[e["eventID"]]))},openApiDoc(e){window.open(e)},clickEvent(e){e.id===this.detailsEvent.id?this.detailsWindows=!this.detailsWindows:(this.detailsEvent=e,this.detailsWindows=!0)},changeViewEvent(e){if(!this.startTrace){const t=this.eventSets[e];this.events=t.events,this.runtimeInfo=t.runtimeInfo,this.infoTraceCount=t.infoTraceCount,this.warningTraceCount=t.warningTraceCount,this.viewEvent=e}},outputLogFile(){let e=(new Date).getTime();(0,C.Z)("log"+e+".txt",JSON.stringify(this.eventSets))}},mounted(){let e=this;this.$socketIO.on("connect",(t=>{e.socketConnect=!0,console.log("startConnect")})),this.$socketIO.on("ConnectInfo",(e=>{console.log(e)})),this.$socketIO.on("DetourEvent",(t=>{console.log(t),t.data["warnings"]=t.data["warnings"].sort(((e,t)=>e.WarningID-t.WarningID)),e.events.unshift(t.data),t.data["warningLevel"]>0&&(e.warningTraceCount[t.data["eventID"]]+=t.data["warnings"].length),e.infoTraceCount[t.data["eventID"]]++,"HookFunc"===t.data["eventID"]&&("StartTrace"===t.data["event"]["Operation"]?(e.pid=t.data["pid"],e.threadID=t.data["threadID"]):"StopTrace"===t.data["event"]["Operation"]&&(e.startTrace=!1))})),this.$socketIO.on("disconnect",(t=>{e.socketConnect=!1,console.log("EndConnect")}))}});var T=a(4379),q=a(5607),I=a(4554),x=a(151),j=a(5589),S=a(6112),H=a(4607),U=a(9721),E=a(7704),F=a(7030),Z=a(7011),L=a(3414),z=a(2035),M=a(5096),Q=a(2350),O=a(5869),Y=a(7518),B=a.n(Y);D.render=_;const K=D;B()(D,"components",{QPage:T.Z,QBanner:q.Z,QIcon:I.Z,QCard:x.Z,QCardSection:j.Z,QInput:S.Z,QBtn:H.Z,QBadge:U.Z,QScrollArea:E.Z,QChip:F.Z,QList:Z.Z,QItem:L.Z,QItemSection:z.Z,QAvatar:M.Z,QItemLabel:Q.Z,QSeparator:O.Z})}}]);